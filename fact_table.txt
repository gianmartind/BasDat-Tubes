===============
Masalah 1
===============
- Kasus per Benua

-- Rancangan tabel
CREATE TABLE continent_cases (
	continent STRING,
	cdate DATE,
	new_cases INT
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY ','
tblproperties ("skip.header.line.count"="1"); 

-- query agregat
INSERT OVERWRITE DIRECTORY '/basdatpbd/tubes_out/continent_cases'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
SELECT continent, cdate, sum(new_cases) as cases
FROM covid_cases
GROUP BY continent, cdate;

LOAD DATA INPATH '/basdatpbd/tubes_out/continent_cases' OVERWRITE INTO TABLE continent_cases;

- Vaksinasi per Benua

-- Rancangan tabel
CREATE TABLE continent_vaccinations (
	continent STRING,
	cdate DATE,
	daily_vaccinations INT
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY ','
tblproperties ("skip.header.line.count"="1"); 

-- query agregat
INSERT OVERWRITE DIRECTORY '/basdatpbd/tubes_out/continent_vaccinations'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
SELECT continent, vaccinations.cdate, sum(daily_vaccinations) as daily_vacc
FROM vaccinations INNER JOIN locations ON vaccinations.location = locations.location
GROUP BY continent, cdate;

LOAD DATA INPATH '/basdatpbd/tubes_out/continent_vaccinations' OVERWRITE INTO TABLE continent_vaccinations;

===============
Masalah 2
===============
- Persentase kematian
CREATE TABLE death_percent (
	continent STRING,
	cmonth INT,
	percentage FLOAT
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY ','; 
tblproperties ("skip.header.line.count"="1"); 

-- query agregat
INSERT OVERWRITE DIRECTORY '/basdatpbd/tubes_out/death_percent'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
SELECT continent, covid_cases.cweek, (sum(new_death)/sum(new_date)) as percentage
FROM covid_cases INNER JOIN date_details ON covid_cases.cdate = date_details.cdate
GROUP BY continent, cweek;